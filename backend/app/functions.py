from imblearn.under_sampling import RandomUnderSampler as RUS
from sklearn.utils import resample

from idict import let
from idict.function.dataset import Xy2M
from idict.function.model import fit
from idict.function.vizualization import X2histogram, Xy2scatterplot
from idict.macro.data import xywrapper
from idict.macro.higherorder import compose


def histogram_macro(col, bins=8):
    """
    >>> import numpy as np
    >>> from idict import idict
    >>> from idict.function.dataset import df2Xy
    >>> d = idict.fromtoy(output_format="df") >> df2Xy
    >>> (d >> histogram_macro(col=0, bins=3)).histogram
    [{'x': '(0.099, 2.133]', 'count': 7}, {'x': '(2.133, 5.1]', 'count': 7}, {'x': '(5.1, 31.1]', 'count': 6}]
    """
    return compose(
        Xy2M,
        let(X2histogram, input="M", col=col, bins=bins)
    )


def scatter_macro(colx, coly, n=500, seed=0):
    """
    >>> import numpy as np
    >>> from idict import idict
    >>> X = np.array([[0, "a", 1.6], [3.2, "b", 2], [8, "c", 3]])
    >>> y = np.array([2, 4.6, 3.2])
    >>> (idict(X=X, y=y) >> scatter_macro(0,2)).scatterplot
    [{'id': '2.0', 'data': [{'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}, {'x': 0.0, 'y': 1.6}]}, {'id': '4.6', 'data': [{'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}, {'x': 3.2, 'y': 2.0}]}, {'id': '3.2', 'data': [{'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}, {'x': 8.0, 'y': 3.0}]}]
    """
    return compose(
        let(fit, algorithm=RUS),
        xywrapper(function=resample, n_samples=n, random_state=seed),
        Xy2M,
        let(Xy2scatterplot, Xin="M", colx=colx, coly=coly)
    )
